# Heap
The heap is part of the system for dynamic allocation of memory.
This is because in order to use the stack, we need to know whether it will be 
used, and how much memory to reserve. Thus it cannot be used dynamically. \
A lot of programs, however, will need to deal with input of varying sizes, at
varying times. For this purpose we have the heap.

## Malloc
Malloc is the standard implementation of a dynamic allocator. It is part of the
standard C library, and is defined in the `stdlib.h` header. \
There are many great resources on how glibc's malloc works, but I am writing
this for myself....

Malloc provides at least two functions to manage dynamic memory:
```
malloc(size_t size);
free(void* ptr);
```
`malloc` will allocate new memory and return a pointer to this allocated memory,
for use by the program. \
`free` will free the memory so it can be resused and avoid leaking.

When malloc is first called it checks where the current program break is by 
calling `brk(NULL)`. It then sets up a new heap of some heuristically chosen 
size by calling `brk(a+size)` where a is the value returned by the first `brk`.


Ex:
```
brk(NULL)                               = 0x440000
brk(0x461000)                           = 0x461000
brk(NULL)                               = 0x461000
```
Now the internal heap size available to malloc is 0x21000 bytes.

The malloc implementation then manages this blob of memory using varios algorithms.
The main purposes of which are effeciency and speed. \
Should the program require more memory than servicable by the current heap size
malloc will expand it's heap by calling `brk` again.

Seen by the following program:

```
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#define FLAG_SZ 0x2000
int main() {

    char* y = malloc(FLAG_SZ);
    for (int i = 0; i < 20; i++) {
        y = malloc(FLAG_SZ);
    }

}

brk(NULL)                               = 0x13c4000
brk(0x13e5000)                          = 0x13e5000
brk(NULL)                               = 0x13e5000
brk(NULL)                               = 0x13e5000
brk(0x1407000)                          = 0x1407000
```


### dlmalloc
This is the "original" malloc, written by Doug Lea